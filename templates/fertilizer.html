{% extends "base.html"%}

{% block title %}fertilizer{% endblock %}
    {% block head %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
    />
    <style>
      :root {
        --agri-green: #28a745;
        --agri-dark: #1e7e34;
        --glass: rgba(255, 255, 255, 0.1);
        --glass-border: rgba(255, 255, 255, 0.2);
      }
      body {
        background-color: #0f1b14;
        font-family: 'Inter', sans-serif;
      }
      .navbar {
        background-color: var(--agri-green);
        color: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .col-lg-8{
        width:  auto !important;
      }
      .row{
        margin-right: 0 !important;
        margin-left: 0 !important;
      }
     
      .agri-card {
        background: var(--glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 30px;
        padding: 40px;
        margin-bottom: 50px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }
      .btn-agri {
        background-color: var(--agri-green);
        color: white;
        border-radius: 25px;
        font-weight: bold;
        transition: 0.3s;
        padding: 15px 50px;
        width: auto;
        position:relative;
        left: 50%;
        transform: translateX(-50% );        
      }
      .btn-agri:hover {
    background: #96d152;
      }
      .result-section {
        border-left: 8px solid var(--agri-green);
        background: var(--glass);
        border-radius: 10px;
      }
      label {
        color: #a8e063;
        font-size: 0.85rem;
        text-transform: uppercase;
        font-weight: 600;
      }
      .form-label {
        color: var(--sprout);
        font-size: 0.85rem;
        text-transform: uppercase;
        font-weight: 600;
      }
      .form-control {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid var(--glass-border);
        color: white;
        border-radius: 12px;
      }
      .form-control:focus {
        background: rgba(255, 255, 255, 0.07);
        border-color: var(--sprout);
        color: white;
        box-shadow: 0 0 15px rgba(168, 224, 99, 0.2);
      }
      option {
        background-color: #0f1b14;
        color: white;
        border-radius: 12px;
        border: none;
      }
      optgroup {
        background-color: #0f1b14;
        color: #a8e063;
        font-weight: bold;
        border-radius: 12px;
        padding: 5px 10px;
      }
      .modal-content {
    background: rgba(26, 47, 35, 0.95) !important;
    backdrop-filter: blur(25px) !important;
    border: 1px solid var(--sprout) !important;
    border-radius: 30px !important;
}
    </style>
    {% endblock %}
   
{% block content %}
  
    <div class="main-container">
      <div class="text-center mb-4">
        <h2
          style="
            color: #ffffff;
            font-size: calc(1.425rem + 2.1vw);
            font-weight: 300;
            margin-top: 90px;
          "
        >
          Fertilizer Recommendation
        </h2>
        <p class="text-light" style="opacity: 0.7">
          Choose the best fertilizer for your crop
        </p>
      </div>

      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card agri-card p-4">
            <form action="{{ url_for('fertilizer.predict_fertilizer') }}" method="POST">
              <div class="row">
                <div class="col-md-6 form-group">
                  <label>Soil Type</label>
                  <select name="soil_type" class="form-control" required>
                    <option value="" selected disabled>-- Choose a Crop --</option>
                    <option value="Black">Black</option>
                    <option value="Red">Red</option>
                    <option value="Clayey">Clayey</option>
                    <option value="Loamy">Loamy</option>
                    <option value="Sandy">Sandy</option>
                  </select>
                </div>
                <div class="col-md-6 form-group">
                  <label>Select Crop</label>
                  <select name="crop_type" class="form-control" required>
                    <option value="" selected disabled>
                      -- Choose a Crop --
                    </option>
                    <optgroup label="Cereals">
                      <option value="Maize">Maize</option>
                      <option value="Wheat">Wheat</option>
                      <option value="Paddy">Paddy</option>
                      <option value="Jowar">Jowar</option>
                      <option value="Bajra">Bajra</option>
                    </optgroup>
                    <optgroup label="Cash Crops">
                      <option value="Sugarcane">Sugarcane</option>
                      <option value="Cotton">Cotton</option>
                      <option value="Tobacco">Tobacco</option>
                    </optgroup>
                    <optgroup label="Oilseeds & Pulses">
                      <option value="Ground Nuts">Ground Nuts</option>
                      <option value="Soybean">Soybean</option>
                      <option value="Chickpea">Chickpea</option>
                      <option value="Mustard">Mustard</option>
                    </optgroup>
                    <optgroup label="Fruits & Veggies">
                      <option value="Pomegranate">Pomegranate</option>
                      <option value="Banana">Banana</option>
                      <option value="Tomato">Tomato</option>
                      <option value="Onion">Onion</option>
                    </optgroup>
                  </select>
                </div>
              </div>

              <div class="row mt-3">
                <div class="col-md-4 form-group">
                  <label>Nitrogen (N)</label>
                  <input
                    type="number"
                    name="nitrogen"
                    class="form-control"
                    placeholder="e.g. 40"
                    required
                  />
                </div>
                <div class="col-md-4 form-group">
                  <label>Phosphorous (P)</label>
                  <input
                    type="number"
                    name="phosphorous"
                    class="form-control"
                    placeholder="e.g. 30"
                    required
                  />
                </div>
                <div class="col-md-4 form-group">
                  <label>Potassium (K)</label>
                  <input
                    type="number"
                    name="potassium"
                    class="form-control"
                    placeholder="e.g. 20"
                    required
                  />
                </div>
              </div>

              <button type="submit" class="btn btn-agri btn-block mt-4 py-2">
                Check Recommendation
              </button>
            </form>
          </div>

          {% if prediction %}
          <div class="result-section p-4 mt-5 shadow">
            {% if missing %}
            <h4 style="color: #fff;">Analysis Report:</h4>
            <div class="d-flex align-items-center mb-3">
              <h1 class="text-success mr-3" style="font-weight: 800">
                {{ prediction }}
              </h1>
              <span class="badge badge-outline-success border p-2" style="color: #fff;"
                >Recommended Fertilizer</span
              >
            </div>

            <hr />

            <div class="mt-3">
              <h6 class="text-danger font-weight-bold">
                ⚠️ Soil Deficiency Detected:
              </h6>
              <div class="d-flex flex-wrap mt-2">
                {% for item in missing %}
                <span
                  class="badge badge-danger p-2 m-1"
                  style="border-radius: 15px"
                  >{{ item }}</span
                >
                {% endfor %}
              </div>
            </div>

            <div class="mt-4 p-3 bg-light rounded">
              <small
                ><strong>AgriScan Advice:</strong> Due to low nutrient levels in
                your soil, we recommend using
                <b>{{ prediction }}</b> for optimal yield.</small
              >
            </div>

            {% else %}
            <div class="text-center py-4">
              <h1 style="font-size: 60px">✅</h1>
              <h3 class="text-success font-weight-bold">
                Soil nutrients are sufficient for {{ crop }}!
              </h3>
              <p class="text-muted">
                Currently, no additional fertilizer application is required.
              </p>
              <a href="/fertilizer" class="btn btn-outline-success btn-sm mt-3"
                >Start New Analysis</a
              >
            </div>
            {% endif %}
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endblock %}

